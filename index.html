<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jun Loye | Digital Garden</title>
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a1a;
            --text-soft: #707070;
            --line: #efefef;
        }

        * { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); }

        body {
            font-family: "Inter", "PingFang SC", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            max-width: 1100px;
            margin: 0 auto;
            padding: 10px 25px;
            line-height: 1.5;
        }

        /* å¯¼èˆªä¸æ¬¢è¿è¯­ */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0 20px 0;
            border-bottom: 1px solid var(--line);
            margin-bottom: 30px;
        }
        .brand { font-weight: 900; letter-spacing: 2px; font-size: 1.1rem; }
        .hero { margin-bottom: 40px; }
        .hero h1 { font-size: 2.4rem; font-weight: 800; margin: 0; letter-spacing: -1.5px; }
        .hero p { color: var(--text-soft); font-size: 1rem; margin-top: 5px; }

        /* æ–‡ç« ç½‘æ ¼ */
        .post-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }
        .post-card { text-decoration: none; color: inherit; display: flex; flex-direction: column; border-radius: 12px; overflow: hidden; }
        .post-cover { width: 100%; height: 180px; background-color: #f0f0f0; border-radius: 10px; margin-bottom: 12px; overflow: hidden; }
        .post-cover img { width: 100%; height: 100%; object-fit: cover; }
        .post-card-title { font-size: 1.25rem; font-weight: 700; margin: 0 0 8px 0; }
        .post-card-desc { font-size: 0.9rem; color: var(--text-soft); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* éŸ³ä¹æ’­æ”¾å™¨ */
        .music-player {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 50px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--line);
            z-index: 100;
        }
        .disc { 
            width: 32px; height: 32px; background: #333; border-radius: 50%; cursor: pointer; 
            animation: rotate 5s linear infinite paused; position: relative;
        }
        .disc::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 8px; height: 8px; background: #fff; border-radius: 50%; }
        .disc.playing { animation-play-state: running; }
        .music-title { font-size: 0.75rem; color: var(--text-soft); max-width: 0; overflow: hidden; white-space: nowrap; transition: max-width 0.5s ease; }
        .music-player:hover .music-title { max-width: 150px; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        footer { margin-top: 60px; padding: 30px 0; border-top: 1px solid var(--line); text-align: center; color: var(--text-soft); font-size: 0.75rem; }
    </style>
</head>
<body>

    <nav>
        <div class="brand">JUN LOYE</div>
        <div class="search-box">
            <input type="text" id="search-input" style="padding: 8px 15px; border-radius: 30px; border: 1px solid var(--line); outline: none; font-size: 0.8rem;" placeholder="æœç´¢...">
        </div>
    </nav>

    <header class="hero">
        <h1 id="welcome-text">Loading...</h1>
        <p>æ¢ç´¢ä»£ç é€»è¾‘ï¼Œå®è·µè®¾è®¡ç•™ç™½ã€‚</p>
    </header>

    <main class="post-grid" id="post-list-container"></main>

    <div class="music-player">
        <span class="music-title" id="track-name">Loading Music...</span>
        <div class="disc" id="music-btn" title="ç‚¹å‡»æ’­æ”¾/ä¸‹ä¸€é¦–"></div>
        <audio id="bg-audio"></audio>
    </div>

    <footer>
        <p>Â© <span id="year"></span> JUN LOYE Â· CRAFTED BY HAND</p>
    </footer>

    <script>
        const CONFIG = {
            username: 'JunLoye',
            repo: 'junloye.github.io',
            branch: 'main',
            musicFolder: 'music' // ä½ çš„éŸ³ä¹æ–‡ä»¶å¤¹åç§°
        };

        let playlist = [];
        let currentTrackIdx = 0;

        // 1. è‡ªåŠ¨ä» GitHub è·å–éŸ³ä¹åˆ—è¡¨
        async function loadPlaylist() {
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.musicFolder}?ref=${CONFIG.branch}`);
                const files = await response.json();
                
                // è¿‡æ»¤å‡º mp3 æ–‡ä»¶å¹¶ç”Ÿæˆæ’­æ”¾åˆ—è¡¨
                playlist = files
                    .filter(file => file.name.endsWith('.mp3'))
                    .map(file => ({
                        name: file.name.replace('.mp3', ''),
                        url: `https://raw.githubusercontent.com/${CONFIG.username}/${CONFIG.repo}/${CONFIG.branch}/${file.path}`
                    }));

                if (playlist.length > 0) {
                    initPlayer();
                } else {
                    document.getElementById('track-name').textContent = "No Music Found";
                }
            } catch (error) {
                console.error("Music List Error:", error);
                document.getElementById('track-name').textContent = "Music Error";
            }
        }

        // 2. æ’­æ”¾å™¨æ§åˆ¶é€»è¾‘
        const audio = document.getElementById('bg-audio');
        const musicBtn = document.getElementById('music-btn');
        const trackTitle = document.getElementById('track-name');

        function initPlayer() {
            const track = playlist[currentTrackIdx];
            audio.src = track.url;
            trackTitle.textContent = track.name;
        }

        musicBtn.onclick = () => {
            if (audio.paused) {
                audio.play().catch(() => alert("ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®åå†æ’­æ”¾"));
                musicBtn.classList.add('playing');
            } else {
                audio.pause();
                musicBtn.classList.remove('playing');
            }
        };

        audio.onended = () => {
            currentTrackIdx = (currentTrackIdx + 1) % playlist.length;
            initPlayer();
            audio.play();
        };

        // 3. æŠ“å– Issues (ä¿æŒåŸæœ‰é€»è¾‘)
        async function fetchPosts() {
            const container = document.getElementById('post-list-container');
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/issues?state=open&sort=created`);
                const issues = await res.json();
                const posts = issues.filter(i => !i.pull_request);
                container.innerHTML = '';
                posts.forEach(issue => {
                    const body = issue.body || "";
                    const cover = body.match(/### ğŸ–¼ï¸ å°é¢å›¾é“¾æ¥\s*(http\S+)/) || body.match(/!\[.*\]\((.*?)\)/);
                    const img = cover ? cover[1] : `https://picsum.photos/seed/${issue.id}/800/450`;
                    const excerpt = body.match(/### ğŸ“– æ–‡ç« ç®€è¿°\s*([\s\S]*?)(?=\s*###)/);
                    const summary = excerpt ? excerpt[1].trim() : body.substring(0, 60);
                    container.insertAdjacentHTML('beforeend', `
                        <a href="${issue.html_url}" class="post-card" target="_blank" style="animation: fadeIn 0.6s ease forwards;">
                            <div class="post-cover"><img src="${img}" alt="Cover"></div>
                            <div class="post-meta"><span class="post-tag">POST</span><span>${new Date(issue.created_at).toLocaleDateString()}</span></div>
                            <h2 class="post-card-title">${issue.title}</h2>
                            <p class="post-card-desc">${summary}...</p>
                        </a>`);
                });
            } catch (e) { container.innerHTML = 'åŠ è½½å¤±è´¥'; }
        }

        // 4. å…¶ä»– UI é€»è¾‘
        function updateWelcome() {
            const hour = new Date().getHours();
            const el = document.getElementById('welcome-text');
            if (hour >= 5 && hour < 12) el.textContent = "æ—©å®‰ï¼Œæ—…äººã€‚";
            else if (hour >= 12 && hour < 18) el.textContent = "åˆå®‰ï¼Œæ—…äººã€‚";
            else el.textContent = "æ™šå®‰ï¼Œæ—…äººã€‚";
        }

        // å¯åŠ¨
        updateWelcome();
        fetchPosts();
        loadPlaylist();
        document.getElementById('year').textContent = new Date().getFullYear();
    </script>
</body>
</html>