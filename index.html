<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jun Loye | Digital Garden</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg: #ffffff;
            --text: #111111;
            --text-soft: #555555;
            --line: #efefef;
            --accent: #007AFF;
            --overlay-bg: #ffffff;
            --container-width: 750px;
            --selection-bg: rgba(0, 122, 255, 0.15);
        }

        [data-theme="dark"] {
            --bg: #0a0a0a;
            --text: #eeeeee;
            --text-soft: #aaaaaa;
            --line: #222222;
            --accent: #0A84FF;
            --overlay-bg: #111111;
            --selection-bg: rgba(10, 132, 255, 0.3);
        }

        [data-width="wide"] { --container-width: 1100px; }

        /* æç®€æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--line); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-soft); }

        /* æ–‡æœ¬é€‰æ‹© */
        ::selection { background: var(--selection-bg); color: var(--accent); }

        /* å³é”®èœå• */
        #custom-context-menu {
            position: fixed; display: none; z-index: 2000;
            background: var(--bg); backdrop-filter: blur(12px);
            border: 1px solid var(--line); border-radius: 10px;
            padding: 5px 0; width: 160px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .menu-item { padding: 8px 15px; font-size: 0.85rem; cursor: pointer; color: var(--text); }
        .menu-item:hover { background: var(--line); }
        .menu-divider { height: 1px; background: var(--line); margin: 5px 0; }

        * { box-sizing: border-box; transition: background 0.3s, color 0.3s, border 0.3s, transform 0.3s cubic-bezier(0.165, 0.84, 0.44, 1); }

        body {
            font-family: "Inter", "PingFang SC", sans-serif;
            background-color: var(--bg); color: var(--text);
            max-width: 1100px; margin: 0 auto; padding: 10px 25px; line-height: 1.6;
        }

        /* å¯¼èˆª */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 0 20px 0; border-bottom: 1px solid var(--line); margin-bottom: 30px; position: sticky; top: 0; background: var(--bg); z-index: 100; }
        .brand { font-weight: 900; letter-spacing: 2px; font-size: 1.1rem; cursor: pointer; }
        .nav-right { display: flex; align-items: center; gap: 12px; }
        .nav-btn { background: var(--line); color: var(--text); border: none; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; cursor: pointer; font-weight: 600; }
        #search-input { padding: 8px 18px; border-radius: 30px; border: 1px solid var(--line); outline: none; font-size: 0.85rem; width: 150px; background: var(--bg); color: var(--text); }

        /* é¦–é¡µç½‘æ ¼ */
        .post-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 40px; }
        .post-card { cursor: pointer; }
        .post-cover { width: 100%; height: 180px; background-color: var(--line); border-radius: 12px; margin-bottom: 15px; overflow: hidden; border: 1px solid var(--line); }
        .post-cover img { width: 100%; height: 100%; object-fit: cover; }
        .post-card-title { font-size: 1.25rem; font-weight: 800; margin: 0 0 8px 0; }
        .post-card-summary { font-size: 0.9rem; color: var(--text-soft); }

        /* è¯¦æƒ…é¡µ */
        #post-detail-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--overlay-bg); z-index: 500; display: none; overflow-y: auto; }
        .detail-container { max-width: var(--container-width); margin: 0 auto; padding: 40px 25px 100px; }
        .detail-hero-img { width: 100%; height: 260px; border-radius: 12px; object-fit: cover; margin-bottom: 20px; border: 1px solid var(--line); }
        .detail-header { margin-bottom: 25px; display: flex; flex-direction: column; gap: 2px; }
        .detail-date { color: var(--text-soft); font-size: 0.85rem; }
        .detail-title { font-size: 2.4rem; font-weight: 800; line-height: 1.1; margin: 0; }
        .detail-tag { font-size: 0.7rem; font-weight: 700; color: var(--accent); letter-spacing: 1px; text-transform: uppercase; }
        .close-btn { position: fixed; top: 25px; left: 25px; background: var(--text); color: var(--bg); padding: 10px 20px; border-radius: 30px; cursor: pointer; font-size: 0.8rem; z-index: 600; font-weight: 600; border: none; }
        .markdown-body { font-size: 1.1rem; line-height: 1.75; color: var(--text); }

        /* æ’­æ”¾å™¨äº¤äº’æ ¸å¿ƒä¿®å¤ */
        .music-player-container { position: fixed; bottom: 25px; right: 25px; z-index: 1000; }
        .music-player { background: var(--bg); padding: 6px; border-radius: 50px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); display: flex; align-items: center; border: 1px solid var(--line); }
        .music-info { max-width: 0; opacity: 0; overflow: hidden; display: flex; align-items: center; transition: all 0.5s ease; white-space: nowrap; font-size: 0.75rem; color: var(--text-soft); }
        
        /* ä»…åœ¨ is-playing ç±»å­˜åœ¨æ—¶å±•å¼€ */
        .music-player.is-playing .music-info { max-width: 200px; opacity: 1; padding: 0 10px 0 15px; }
        
        .disc { width: 34px; height: 34px; background: var(--text); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; animation: rotate 5s linear infinite paused; flex-shrink: 0; }
        .disc.playing { animation-play-state: running; }
        .disc svg { width: 14px; height: 14px; fill: var(--bg); }
        
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        footer { margin-top: 80px; padding: 40px 0; border-top: 1px solid var(--line); text-align: center; color: var(--text-soft); font-size: 0.8rem; }
    </style>
</head>
<body data-theme="light" data-width="normal">

    <div id="custom-context-menu">
        <div class="menu-item" onclick="location.reload()">åˆ·æ–°é¡µé¢</div>
        <div class="menu-item" onclick="toggleDarkMode()">åˆ‡æ¢ä¸»é¢˜</div>
        <div class="menu-divider"></div>
        <div class="menu-item" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">å›åˆ°é¡¶éƒ¨</div>
        <div class="menu-item" onclick="closePost()">å…³é—­æ–‡ç« </div>
    </div>

    <nav>
        <div class="brand" onclick="location.reload()">JUN LOYE</div>
        <div class="nav-right">
            <button class="nav-btn" onclick="toggleWideMode()" id="wide-btn">å®½å±</button>
            <button class="nav-btn" onclick="toggleDarkMode()" id="theme-btn">æ·±è‰²</button>
            <input type="text" id="search-input" placeholder="æœç´¢...">
        </div>
    </nav>

    <header class="hero">
        <h1 id="welcome-text">ä½ å¥½ï¼Œæ—…äººã€‚</h1>
        <p>æ¢ç´¢ä»£ç é€»è¾‘ï¼Œå®è·µè®¾è®¡ç•™ç™½ã€‚</p>
    </header>

    <div id="post-detail-overlay">
        <button class="close-btn" onclick="closePost()">â† CLOSE</button>
        <div class="detail-container" id="detail-content-area"></div>
    </div>

    <main class="post-grid" id="post-list-container"></main>

    <div class="music-player-container">
        <div id="player-bar" class="music-player">
            <div class="music-info"><span id="track-name">Music</span></div>
            <div class="disc" id="music-btn"><svg viewBox="0 0 24 24"><path id="btn-icon-path" d="M8 5v14l11-7z"/></svg></div>
            <audio id="bg-audio"></audio>
        </div>
    </div>

    <footer><p>Â© <span id="year"></span> JUN LOYE</p></footer>

    <script>
        const CONFIG = { username: 'JunLoye', repo: 'junloye.github.io', branch: 'main', musicFolder: 'music' };
        const ICON_PLAY = "M8 5v14l11-7z", ICON_PAUSE = "M6 19h4V5H6v14zm8-14v14h4V5h-4z";
        let allIssues = [];

        // å³é”®èœå•
        const contextMenu = document.getElementById('custom-context-menu');
        window.oncontextmenu = (e) => { e.preventDefault(); contextMenu.style.display = 'block'; contextMenu.style.left = e.clientX+'px'; contextMenu.style.top = e.clientY+'px'; };
        window.onclick = () => contextMenu.style.display = 'none';

        function toggleDarkMode() {
            const isLight = document.body.getAttribute('data-theme') === 'light';
            document.body.setAttribute('data-theme', isLight ? 'dark' : 'light');
            document.getElementById('theme-btn').textContent = isLight ? 'æµ…è‰²' : 'æ·±è‰²';
        }
        function toggleWideMode() {
            const isNormal = document.body.getAttribute('data-width') === 'normal';
            document.body.setAttribute('data-width', isNormal ? 'wide' : 'normal');
            document.getElementById('wide-btn').textContent = isNormal ? 'å¸¸è§„' : 'å®½å±';
        }

        async function fetchPosts() {
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/issues?state=open&sort=created`);
                allIssues = (await res.json()).filter(i => !i.pull_request);
                renderPosts(allIssues);
            } catch (e) { document.getElementById('post-list-container').innerHTML = 'åŠ è½½å¤±è´¥'; }
        }

        function renderPosts(posts) {
            const container = document.getElementById('post-list-container');
            container.innerHTML = posts.map(issue => {
                const body = issue.body || "";
                const cover = body.match(/### ğŸ–¼ï¸ å°é¢å›¾é“¾æ¥\s*(http\S+)/)?.[1] || `https://picsum.photos/seed/${issue.id}/800/450`;
                const summary = body.match(/### ğŸ“– æ–‡ç« ç®€è¿°\s*([\s\S]*?)(?=\n---|###|$)/)?.[1]?.trim() || "é˜…è¯»å…¨æ–‡...";
                return `<div class="post-card" onclick="openPost(${issue.number})">
                    <div class="post-cover"><img src="${cover}"></div>
                    <h2 class="post-card-title">${issue.title}</h2>
                    <div class="post-card-summary">${summary}</div>
                </div>`;
            }).join('');
        }

        function openPost(num) {
            const issue = allIssues.find(i => i.number === num);
            const cover = issue.body.match(/### ğŸ–¼ï¸ å°é¢å›¾é“¾æ¥\s*(http\S+)/)?.[1] || `https://picsum.photos/seed/${issue.id}/800/450`;
            let cleanBody = issue.body.replace(/### ğŸ–¼ï¸ å°é¢å›¾é“¾æ¥[\s\S]*?(?=\n---|###|$)/, "").replace(/### ğŸ“– æ–‡ç« ç®€è¿°[\s\S]*?(?=\n---|###|$)/, "").replace(/ğŸš€ æ­£æ–‡å†…å®¹/g, "").replace(/ğŸ’¡ å‘å¸ƒæ ¸å¯¹[\s\S]*/, "").replace(/^\s*---\s*/gm, "").trim();
            const date = new Date(issue.created_at).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('detail-content-area').innerHTML = `<img src="${cover}" class="detail-hero-img"><div class="detail-header"><div class="detail-date">${date}</div><h1 class="detail-title">${issue.title}</h1><div class="detail-tag">${issue.labels[0]?.name || 'Article'}</div></div><div class="markdown-body">${marked.parse(cleanBody)}</div>`;
            document.getElementById('post-detail-overlay').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closePost() { document.getElementById('post-detail-overlay').style.display = 'none'; document.body.style.overflow = 'auto'; }

        // æ’­æ”¾å™¨é€»è¾‘æ ¸å¿ƒä¿®å¤
        const audio = document.getElementById('bg-audio'), musicBtn = document.getElementById('music-btn'), 
              playerBar = document.getElementById('player-bar'), trackName = document.getElementById('track-name'),
              iconPath = document.getElementById('btn-icon-path');
        let playlist = [], currentIdx = 0;

        async function loadMusic() {
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.musicFolder}`);
                playlist = (await res.json()).filter(f => f.name.endsWith('.mp3')).map(f => ({
                    name: f.name.replace('.mp3', ''),
                    url: `https://raw.githubusercontent.com/${CONFIG.username}/${CONFIG.repo}/${CONFIG.branch}/${f.path}`
                }));
                if (playlist.length) { audio.src = playlist[0].url; trackName.textContent = playlist[0].name; }
            } catch (e) {}
        }

        function playMusic() {
            audio.play().catch(e => {});
            musicBtn.classList.add('playing');
            playerBar.classList.add('is-playing'); // å±•å¼€
            iconPath.setAttribute('d', ICON_PAUSE);
        }

        function pauseMusic() {
            audio.pause();
            musicBtn.classList.remove('playing');
            playerBar.classList.remove('is-playing'); // éšè—
            iconPath.setAttribute('d', ICON_PLAY);
        }

        musicBtn.onclick = () => audio.paused ? playMusic() : pauseMusic();
        audio.onended = () => { currentIdx = (currentIdx + 1) % playlist.length; audio.src = playlist[currentIdx].url; trackName.textContent = playlist[currentIdx].name; playMusic(); };

        document.getElementById('year').textContent = new Date().getFullYear();
        fetchPosts(); loadMusic();
        document.getElementById('search-input').oninput = (e) => renderPosts(allIssues.filter(i => i.title.toLowerCase().includes(e.target.value.toLowerCase())));
    </script>
</body>
</html>