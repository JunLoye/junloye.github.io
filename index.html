<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jun Loye | Digital Garden</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a1a;
            --text-soft: #707070;
            --line: #efefef;
            --accent: #007AFF;
        }

        * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1); }

        body {
            font-family: "Inter", "PingFang SC", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            max-width: 1100px;
            margin: 0 auto;
            padding: 10px 25px;
            line-height: 1.6;
        }

        /* ÂØºËà™ */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0 20px 0;
            border-bottom: 1px solid var(--line);
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
        }
        .brand { font-weight: 900; letter-spacing: 2px; font-size: 1.1rem; cursor: pointer; }
        #search-input {
            padding: 8px 18px;
            border-radius: 30px;
            border: 1px solid var(--line);
            outline: none;
            font-size: 0.85rem;
            width: 200px;
        }
        #search-input:focus { border-color: var(--accent); width: 250px; }

        .hero { margin-bottom: 40px; }
        .hero h1 { font-size: 2.4rem; font-weight: 800; margin: 0; letter-spacing: -1.5px; }

        .post-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }
        .post-card { text-decoration: none; color: inherit; display: flex; flex-direction: column; border-radius: 12px; cursor: pointer; }
        .post-card:hover { transform: translateY(-5px); }
        .post-cover { width: 100%; height: 180px; background-color: #f9f9f9; border-radius: 10px; margin-bottom: 12px; overflow: hidden; border: 1px solid var(--line); }
        .post-cover img { width: 100%; height: 100%; object-fit: cover; }
        
        .post-meta { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
        .post-tag { font-size: 0.7rem; padding: 2px 10px; border-radius: 20px; background: #f0f0f0; color: var(--text-soft); font-weight: 600; }
        .post-card-title { font-size: 1.2rem; font-weight: 700; margin: 0 0 8px 0; }

        #post-detail-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 2000;
            display: none;
            overflow-y: auto;
        }
        .detail-container { max-width: 750px; margin: 0 auto; padding: 80px 25px; }
        .close-btn { position: fixed; top: 25px; left: 25px; background: #1a1a1a; color: white; padding: 8px 20px; border-radius: 30px; cursor: pointer; font-size: 0.8rem; z-index: 2100; }
        .markdown-body img { max-width: 100%; border-radius: 8px; }

        /* Êí≠ÊîæÂô®‰∫§‰∫í */
        .music-player-container { position: fixed; bottom: 25px; right: 25px; z-index: 1000; display: flex; flex-direction: column; align-items: flex-end; gap: 12px; }
        
        .playlist-menu { 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); 
            border: 1px solid var(--line); border-radius: 18px; width: 200px; 
            max-height: 0; opacity: 0; overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
        }
        .playlist-menu.active { max-height: 250px; opacity: 1; padding: 10px 0; overflow-y: auto; }
        .playlist-item { padding: 10px 20px; font-size: 0.8rem; color: var(--text-soft); cursor: pointer; }
        .playlist-item.playing { color: var(--text); font-weight: 700; background: #f0f0f0; }

        .music-player { 
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); 
            padding: 6px; border-radius: 50px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); 
            display: inline-flex; align-items: center; border: 1px solid var(--line); 
            overflow: hidden;
        }
        
        .music-info {
            max-width: 0; opacity: 0; overflow: hidden; display: flex; align-items: center;
            transition: max-width 0.6s ease, opacity 0.4s ease, padding 0.6s ease;
        }

        .music-player.is-playing .music-info { 
            max-width: 220px; opacity: 1; padding: 0 10px 0 15px; 
        }

        .music-title { font-size: 0.75rem; color: var(--text-soft); white-space: nowrap; }

        .disc { 
            width: 34px; height: 34px; background: #333; border-radius: 50%; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; 
            animation: rotate 5s linear infinite paused; flex-shrink: 0;
        }
        .disc.playing { animation-play-state: running; }
        .disc svg { width: 14px; height: 14px; fill: white; pointer-events: none; }
        
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        footer { margin-top: 60px; padding: 30px 0; border-top: 1px solid var(--line); text-align: center; color: var(--text-soft); font-size: 0.75rem; }
    </style>
</head>
<body>

    <nav>
        <div class="brand" onclick="location.reload()">JUN LOYE</div>
        <div class="search-box">
            <input type="text" id="search-input" placeholder="ÊêúÁ¥¢ÊñáÁ´†Ê†áÈ¢òÊàñÂÜÖÂÆπ...">
        </div>
    </nav>

    <header class="hero">
        <h1 id="welcome-text">Loading...</h1>
        <p>Êé¢Á¥¢‰ª£Á†ÅÈÄªËæëÔºåÂÆûË∑µËÆæËÆ°ÁïôÁôΩ„ÄÇ</p>
    </header>

    <div id="post-detail-overlay">
        <div class="close-btn" onclick="closePost()">‚Üê CLOSE</div>
        <div class="detail-container" id="detail-content-area"></div>
    </div>

    <main class="post-grid" id="post-list-container"></main>

    <div class="music-player-container">
        <div class="playlist-menu" id="playlist-menu"></div>
        <div id="player-bar" class="music-player">
            <div class="music-info" onclick="togglePlaylist()" style="cursor: pointer;">
                <span class="music-title" id="track-name">Music</span>
            </div>
            <div class="disc" id="music-btn">
                <svg viewBox="0 0 24 24"><path id="btn-icon-path" d="M8 5v14l11-7z"/></svg>
            </div>
            <audio id="bg-audio"></audio>
        </div>
    </div>

    <footer>
        <p>¬© <span id="year"></span> JUN LOYE</p>
    </footer>

    <script>
        const CONFIG = {
            username: 'JunLoye',
            repo: 'junloye.github.io',
            branch: 'main',
            musicFolder: 'music'
        };

        const ICON_PLAY = "M8 5v14l11-7z";
        const ICON_PAUSE = "M6 19h4V5H6v14zm8-14v14h4V5h-4z";

        let allIssues = []; // Â≠òÂÇ®ÊâÄÊúâËé∑ÂèñÂà∞ÁöÑ Issue

        // --- Ê†∏ÂøÉ‰øÆÂ§çÔºöÊêúÁ¥¢ÂäüËÉΩ ---
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            // ËøáÊª§Ê†áÈ¢òÊàñÊ≠£ÊñáÂåÖÂê´ÂÖ≥ÈîÆËØçÁöÑÊñáÁ´†
            const filtered = allIssues.filter(issue => 
                issue.title.toLowerCase().includes(term) || 
                (issue.body && issue.body.toLowerCase().includes(term))
            );
            renderPosts(filtered);
        });

        async function fetchPosts() {
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/issues?state=open&sort=created`);
                const data = await res.json();
                // ÊéíÈô§ Pull RequestsÔºåÂè™‰øùÁïôÁúüÊ≠£ÁöÑ Issue
                allIssues = data.filter(i => !i.pull_request);
                renderPosts(allIssues);
            } catch (e) {
                document.getElementById('post-list-container').innerHTML = 'Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•';
            }
        }

        function renderPosts(posts) {
            const container = document.getElementById('post-list-container');
            if (posts.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-soft);">Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÊñáÁ´†</p>';
                return;
            }
            container.innerHTML = posts.map(issue => {
                const body = issue.body || "";
                const cover = body.match(/### üñºÔ∏è Â∞ÅÈù¢ÂõæÈìæÊé•\s*(http\S+)/) || [null, `https://picsum.photos/seed/${issue.id}/800/450`];
                return `
                    <div class="post-card" onclick="openPost(${issue.number})">
                        <div class="post-cover"><img src="${cover[1]}" alt="Cover"></div>
                        <h2 class="post-card-title">${issue.title}</h2>
                    </div>`;
            }).join('');
        }

        // --- ÂÖ∂‰ªñÂéüÊúâÈÄªËæë ---
        function openPost(num) {
            const issue = allIssues.find(i => i.number === num);
            document.getElementById('detail-content-area').innerHTML = `<h1>${issue.title}</h1><div class="markdown-body">${marked.parse(issue.body || "")}</div>`;
            document.getElementById('post-detail-overlay').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closePost() {
            document.getElementById('post-detail-overlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        const audio = document.getElementById('bg-audio');
        const musicBtn = document.getElementById('music-btn');
        const playerBar = document.getElementById('player-bar');
        const trackName = document.getElementById('track-name');
        const iconPath = document.getElementById('btn-icon-path');
        let playlist = [];
        let currentTrackIdx = 0;

        async function loadMusic() {
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.musicFolder}?ref=${CONFIG.branch}`);
                const files = await res.json();
                playlist = files.filter(f => f.name.endsWith('.mp3')).map(f => ({
                    name: f.name.replace('.mp3', ''),
                    url: `https://raw.githubusercontent.com/${CONFIG.username}/${CONFIG.repo}/${CONFIG.branch}/${f.path}`
                }));
                if (playlist.length) {
                    document.getElementById('playlist-menu').innerHTML = playlist.map((t, i) => `<div class="playlist-item" onclick="selectTrack(${i})">${t.name}</div>`).join('');
                    audio.src = playlist[0].url;
                    trackName.textContent = playlist[0].name;
                }
            } catch (e) {}
        }

        function selectTrack(i) {
            currentTrackIdx = i;
            audio.src = playlist[i].url;
            trackName.textContent = playlist[i].name;
            playMusic();
            document.getElementById('playlist-menu').classList.remove('active');
        }

        function playMusic() {
            audio.play().catch(e => console.log("‰∫íÂä®Ëß¶Âèë"));
            musicBtn.classList.add('playing');
            playerBar.classList.add('is-playing');
            iconPath.setAttribute('d', ICON_PAUSE);
        }

        function pauseMusic() {
            audio.pause();
            musicBtn.classList.remove('playing');
            playerBar.classList.remove('is-playing');
            iconPath.setAttribute('d', ICON_PLAY);
        }

        musicBtn.onclick = () => {
            if (audio.paused) playMusic(); else pauseMusic();
        };

        musicBtn.oncontextmenu = (e) => {
            e.preventDefault();
            currentTrackIdx = (currentTrackIdx + 1) % playlist.length;
            selectTrack(currentTrackIdx);
        };

        audio.onended = () => {
            currentTrackIdx = (currentTrackIdx + 1) % playlist.length;
            selectTrack(currentTrackIdx);
        };

        function togglePlaylist() { document.getElementById('playlist-menu').classList.toggle('active'); }

        document.getElementById('year').textContent = new Date().getFullYear();
        document.getElementById('welcome-text').textContent = "‰Ω†Â•ΩÔºåÊóÖ‰∫∫„ÄÇ";
        fetchPosts();
        loadMusic();
    </script>
</body>
</html>